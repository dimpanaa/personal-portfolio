---
// Education component - F1 Track Layout v3
// Path curves AROUND text blocks, not through them
import { getCollection } from "astro:content";

const educationEntries = await getCollection("education");
const sortedEducation = [...educationEntries].sort(
  (a, b) => (a.data.order as number) - (b.data.order as number),
);
---

<section class="section education" id="education">
  <div class="container">
    <h2 class="section-title">Education</h2>

    <div class="education-journey">
      <!-- SVG Path Layer -->
      <svg
        class="flight-path-svg"
        viewBox="0 0 1000 700"
        preserveAspectRatio="xMidYMid meet"
      >
        <!-- 
           Path Design:
           - Oxford at (450, 550): Text on LEFT, marker on RIGHT
           - Path goes DOWN first (below Oxford text), then curves RIGHT
           - Christ at (950, 350): Text on LEFT, marker on RIGHT  
           - Path leaves Christ, goes UP and curves LEFT (above Christ text)
           - BNMIT at (450, 100): Text on LEFT, marker on RIGHT
           - Path arrives from RIGHT (above BNMIT text)
           
           KEY: Path NEVER crosses through text areas!
        -->
        <path
          class="flight-line"
          id="education-path"
          d="M 450 550
             Q 600 650, 800 550
             Q 1000 400, 950 350
             Q 900 300, 800 200
             Q 600 50, 450 100"
          fill="none"
          stroke="rgba(255, 255, 255, 0.4)"
          stroke-width="2.5"
          stroke-dasharray="8 10"
          stroke-linecap="round"></path>

        <!-- Airplane -->
        <g id="airplane">
          <g transform="translate(-18, -18)">
            <path
              d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"
              fill="white"
              transform="scale(1.5) rotate(90 12 12)"></path>
          </g>
        </g>
      </svg>

      <!-- 1. BNMIT (Top) - Text LEFT, Marker RIGHT -->
      <div class="edu-entry edu-bnmit">
        <div class="edu-info">
          <h3 class="edu-title">
            {sortedEducation[0]?.data.institution}
            <span class="edu-location"
              >({sortedEducation[0]?.data.location})</span
            >
          </h3>
          <p class="edu-degree">{sortedEducation[0]?.data.degree}</p>
          <p class="edu-score">{sortedEducation[0]?.data.score}</p>
        </div>
        <div class="marker-wrapper">
          <svg
            class="location-marker current"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
          >
            <path d="M12 21c-4-4-8-7.5-8-12a8 8 0 1 1 16 0c0 4.5-4 8-8 12z"
            ></path>
            <circle cx="12" cy="9" r="3"></circle>
          </svg>
        </div>
      </div>

      <!-- 2. Christ Junior (Right) - Text LEFT, Marker RIGHT -->
      <div class="edu-entry edu-christ">
        <div class="edu-info align-right">
          <h3 class="edu-title">
            {sortedEducation[1]?.data.institution}
            <span class="edu-location"
              >({sortedEducation[1]?.data.location})</span
            >
          </h3>
          <p class="edu-degree">{sortedEducation[1]?.data.degree}</p>
          <p class="edu-score">{sortedEducation[1]?.data.score}</p>
        </div>
        <div class="marker-wrapper">
          <svg
            class="location-marker"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
          >
            <path d="M12 21c-4-4-8-7.5-8-12a8 8 0 1 1 16 0c0 4.5-4 8-8 12z"
            ></path>
            <circle cx="12" cy="9" r="3"></circle>
          </svg>
        </div>
      </div>

      <!-- 3. Oxford (Bottom) - Text LEFT, Marker RIGHT -->
      <div class="edu-entry edu-oxford">
        <div class="edu-info">
          <h3 class="edu-title">
            {sortedEducation[2]?.data.institution}
            <span class="edu-location"
              >({sortedEducation[2]?.data.location})</span
            >
          </h3>
          <p class="edu-degree">{sortedEducation[2]?.data.degree}</p>
          <p class="edu-score">{sortedEducation[2]?.data.score}</p>
        </div>
        <div class="marker-wrapper">
          <svg
            class="location-marker"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
          >
            <path d="M12 21c-4-4-8-7.5-8-12a8 8 0 1 1 16 0c0 4.5-4 8-8 12z"
            ></path>
            <circle cx="12" cy="9" r="3"></circle>
          </svg>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- anime.js from CDN -->
<script
  is:inline
  src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"
></script>

<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    const path = document.getElementById("education-path");
    const airplane = document.getElementById("airplane");

    if (!path || !airplane || typeof anime === "undefined") return;

    airplane.style.display = "block";
    const motionPath = anime.path("#education-path");

    anime({
      targets: "#airplane",
      translateX: motionPath("x"),
      translateY: motionPath("y"),
      rotate: motionPath("angle"),
      easing: "linear",
      duration: 12000,
      loop: true,
    });
  });
</script>

<style>
  .education {
    background: var(--bg-primary);
  }

  .education-journey {
    position: relative;
    height: 700px;
    max-width: 1000px;
    margin: 0 auto;
    margin-top: var(--space-xl);
  }

  .flight-path-svg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
    pointer-events: none;
  }

  .edu-entry {
    position: absolute;
    z-index: 10;
    display: flex;
    align-items: flex-start;
    gap: 16px;
  }

  .marker-wrapper {
    flex-shrink: 0;
    width: 44px;
    height: 44px;
    background: var(--bg-primary);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .location-marker {
    width: 44px;
    height: 44px;
    color: var(--text-primary);
  }

  .location-marker.current {
    color: var(--accent-primary);
  }

  /* 
     Positions - Markers at SVG coords, text extends LEFT
     Path goes to RIGHT of all markers
     
     BNMIT: SVG (450, 100) 
     Christ: SVG (950, 350)
     Oxford: SVG (450, 550)
  */

  .edu-bnmit {
    top: 78px;
    left: 50px;
    /* Marker at right edge = approximately 50 + text width + gap + marker = 450ish */
  }

  .edu-christ {
    top: 328px;
    right: 30px;
    /* Marker on right edge at 950ish */
  }

  .edu-oxford {
    top: 528px;
    left: 50px;
  }

  .edu-info {
    max-width: 350px;
    padding-top: 4px;
  }

  .edu-info.align-right {
    text-align: right;
  }

  .edu-title {
    font-family: var(--font-serif);
    font-size: 1.7rem;
    font-weight: 500;
    color: var(--text-primary);
    margin-bottom: 4px;
    line-height: 1.25;
  }

  .edu-location {
    font-size: 0.95rem;
    color: var(--gray-400);
    font-weight: 300;
    margin-left: 6px;
  }

  .edu-degree {
    font-size: 1.15rem;
    color: var(--text-secondary);
    margin-bottom: 3px;
  }

  .edu-score {
    font-size: 1.1rem;
    color: var(--accent-primary);
    font-weight: 600;
  }

  /* Mobile */
  @media (max-width: 900px) {
    .education-journey {
      height: auto;
      display: flex;
      flex-direction: column;
      gap: 50px;
      padding: 30px 20px;
    }

    .flight-path-svg {
      display: none;
    }

    .edu-entry {
      position: static;
      flex-direction: row !important;
    }

    .edu-info,
    .edu-info.align-right {
      text-align: left;
    }
  }
</style>
