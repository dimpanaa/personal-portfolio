---
// Education component - Final Fixes
// Layout: S-Curve with extreme clearance for text
import { getCollection } from "astro:content";

const educationEntries = await getCollection("education");
const sortedEducation = [...educationEntries].sort(
  (a, b) => (a.data.order as number) - (b.data.order as number),
);
---

<section class="section education" id="education">
  <div class="container">
    <h2 class="section-title">Education</h2>

    <div class="education-journey">
      <!-- SVG Layer -->
      <!-- Z-index 0 to be behind, but path design ensures visual clearance -->
      <svg
        class="flight-path-svg"
        viewBox="0 0 1000 650"
        preserveAspectRatio="xMidYMid meet"
      >
        <!-- 
           Path Calculation:
           
           Point 1: Oxford Marker (Bottom-Left)
           - Marker Center: 50, 550
           - Text is to the RIGHT (approx 80 to 450)
           - Path Start: 50, 550
           
           Point 2: Christ Marker (Middle-Right)
           - Marker Center: 950, 325
           - Text is to the LEFT (approx 550 to 920)
           - To contact 950, 325 without hitting text 550-920...
           - Path must arrive from BELOW or ABOVE, not straight left.
           - User complained "behind text", meaning it crossed the text.
           - Let's Curve BELOW the whole section and come up to 950, 325.
           
           Point 3: BNMIT Marker (Top-Left)
           - Marker Center: 50, 100
           - Text is to the RIGHT (approx 80 to 450)
           - Path comes from 950, 325.
           - Path must arrive at 50, 100 without crossing text 80-450.
           - Path should curve ABOVE the text and drop down to 50, 100.
        -->
        <path
          class="flight-line"
          id="education-path"
          d="M 50 550
             C 100 650, 600 650, 950 325
             C 800 -50, 200 -50, 50 100"
          fill="none"
          stroke="rgba(255, 255, 255, 0.3)"
          stroke-width="2"
          stroke-dasharray="8 8"
          stroke-linecap="round"></path>

        <!-- Airplane Icon -->
        <!-- Standard 'facing right' plane for auto-rotate to work correctly -->
        <g id="airplane">
          <path
            d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"
            fill="white"
            transform="scale(1.5) rotate(90 11.5 11)"></path>
          <!-- rotated 90 because this specific path might be facing up? standard material icon faces up. Rotating 90 makes it face right. -->
        </g>
      </svg>

      <!-- Content Layer -->

      <!-- 1. BNMIT (Top Left) -->
      <div class="edu-entry edu-bnmit">
        <div class="marker-wrapper">
          <svg
            class="location-marker current"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M12 21c-4-4-8-7.5-8-12a8 8 0 1 1 16 0c0 4.5-4 8-8 12z"
            ></path>
            <circle cx="12" cy="9" r="3"></circle>
          </svg>
        </div>
        <div class="edu-info">
          <h3 class="edu-title">
            {sortedEducation[0]?.data.institution}
            <span class="edu-location"
              >({sortedEducation[0]?.data.location})</span
            >
          </h3>
          <p class="edu-degree">{sortedEducation[0]?.data.degree}</p>
          <p class="edu-score">{sortedEducation[0]?.data.score}</p>
        </div>
      </div>

      <!-- 2. Christ Junior (Middle Right) -->
      <div class="edu-entry edu-christ">
        <div class="edu-info align-right">
          <h3 class="edu-title">
            {sortedEducation[1]?.data.institution}
            <span class="edu-location"
              >({sortedEducation[1]?.data.location})</span
            >
          </h3>
          <p class="edu-degree">{sortedEducation[1]?.data.degree}</p>
          <p class="edu-score">{sortedEducation[1]?.data.score}</p>
        </div>
        <div class="marker-wrapper">
          <svg
            class="location-marker"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M12 21c-4-4-8-7.5-8-12a8 8 0 1 1 16 0c0 4.5-4 8-8 12z"
            ></path>
            <circle cx="12" cy="9" r="3"></circle>
          </svg>
        </div>
      </div>

      <!-- 3. Oxford (Bottom Left) -->
      <div class="edu-entry edu-oxford">
        <div class="marker-wrapper">
          <svg
            class="location-marker"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M12 21c-4-4-8-7.5-8-12a8 8 0 1 1 16 0c0 4.5-4 8-8 12z"
            ></path>
            <circle cx="12" cy="9" r="3"></circle>
          </svg>
        </div>
        <div class="edu-info">
          <h3 class="edu-title">
            {sortedEducation[2]?.data.institution}
            <span class="edu-location"
              >({sortedEducation[2]?.data.location})</span
            >
          </h3>
          <p class="edu-degree">{sortedEducation[2]?.data.degree}</p>
          <p class="edu-score">{sortedEducation[2]?.data.score}</p>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  import { animate, svg } from "animejs";

  const initAnimation = () => {
    const path = document.getElementById("education-path") as SVGPathElement;
    const airplane = document.getElementById("airplane");

    if (!path || !airplane) return;

    const motionPath = svg.createMotionPath("#education-path");

    animate("#airplane", {
      ...motionPath,
      rotate: "auto",
      duration: 12000,
      ease: "linear",
      loop: true,
    });
  };

  document.addEventListener("DOMContentLoaded", initAnimation);
</script>

<style>
  .education {
    background: var(--bg-primary);
    overflow: visible;
  }

  .education-journey {
    position: relative;
    height: 650px;
    max-width: 1000px;
    margin: 0 auto;
    margin-top: var(--space-xl);
  }

  .flight-path-svg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 100; /* Bring SVG to front so Plane on top? But path creates visual clash if crossing text. 
                   Since we routed path AROUND text, we can safely put it on top to ensure plane is visible. */
    pointer-events: none;
  }

  /* Make just the path line fully transparent or semi to avoid obscuring? */
  .flight-line {
    /* kept visible as requested "dotted path" */
  }

  .edu-entry {
    position: absolute;
    /* Z-index lower than plane (100) but markers need to be visible. Plane triggers z-index context? */
    /* SVG is z-100. Entries z-10. */
    /* If path crosses text now, it will be ON TOP of text. */
    /* We routed path AROUND text, so this is safe and ensures Plane is visible. */
    z-index: 10;
    display: flex;
    align-items: flex-start;
    gap: 20px;
  }

  .marker-wrapper {
    flex-shrink: 0;
    width: 40px;
    height: 40px;
    display: flex;
    justify-content: center;
    background: var(--bg-primary);
    border-radius: 50%;
    z-index: 20; /* Markers above path line */
  }

  /* 
     CSS Positioning matching SVG Coords
     BNMIT: 50, 100
     Christ: 950, 325
     Oxford: 50, 550
  */

  .edu-bnmit {
    top: 80px;
    left: 30px;
  }

  .edu-christ {
    top: 305px;
    right: 30px;
  }

  .edu-oxford {
    top: 530px;
    left: 30px;
  }

  .location-marker {
    width: 40px;
    height: 40px;
    color: white;
    filter: drop-shadow(0 0 8px rgba(0, 0, 0, 0.8));
    fill: var(--bg-primary);
  }

  .location-marker.current {
    color: var(--accent-primary);
  }

  .edu-info {
    max-width: 380px;
    padding-top: 5px;
  }

  .edu-info.align-right {
    text-align: right;
  }

  .edu-title {
    font-family: var(--font-serif);
    font-size: 1.7rem;
    font-weight: 500;
    color: var(--text-primary);
    margin-bottom: 5px;
    line-height: 1.25;
  }

  .edu-location {
    font-size: 0.95rem;
    color: var(--gray-400);
    font-weight: 300;
  }

  .edu-degree {
    font-size: 1.15rem;
    color: var(--text-secondary);
    margin-bottom: 4px;
    font-weight: 300;
  }

  .edu-score {
    font-size: 1.1rem;
    color: var(--accent-primary);
    font-weight: 600;
  }

  @media (max-width: 900px) {
    .education-journey {
      height: auto;
      display: flex;
      flex-direction: column;
      gap: 60px;
      padding: 40px 20px;
    }

    .flight-path-svg {
      display: none;
    }

    .edu-entry {
      position: static;
    }

    .edu-christ {
      flex-direction: row-reverse;
      align-self: flex-end;
    }

    .edu-christ .edu-info {
      text-align: right;
    }
  }
</style>
