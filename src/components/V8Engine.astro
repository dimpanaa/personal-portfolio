---
// V8 Engine Sketchfab Embed Component
// Large background, grayscale, no UI visible, fades on scroll
---

<div class="v8-engine-container" id="v8-container">
  <div class="v8-engine-wrapper" id="v8-background">
    <!-- Loading spinner -->
    <div class="v8-loader" id="v8-loader">
      <div class="loader-spinner"></div>
    </div>
  </div>
</div>

<script is:inline>
  // Lazy load the Sketchfab embed
  let iframeLoaded = false;

  const loadV8Engine = () => {
    if (iframeLoaded) return;

    const container = document.getElementById("v8-background");
    const loader = document.getElementById("v8-loader");

    const iframe = document.createElement("iframe");
    iframe.title = "V8 Engine";
    iframe.className = "v8-iframe";
    // All UI disabled, auto-rotate
    iframe.src =
      "https://sketchfab.com/models/0bf1c1280f3443fbb0ae4a46d215e0d9/embed?autospin=0.15&autostart=1&preload=1&transparent=1&ui_theme=dark&ui_controls=0&ui_infos=0&ui_inspector=0&ui_stop=0&ui_watermark=0&ui_watermark_link=0&ui_ar=0&ui_help=0&ui_settings=0&ui_vr=0&ui_fullscreen=0&ui_annotations=0&ui_hint=0&dnt=1";
    iframe.frameBorder = "0";
    iframe.allow = "autoplay; fullscreen; xr-spatial-tracking";
    iframe.allowFullscreen = true;

    iframe.onload = () => {
      loader?.classList.add("hidden");
    };

    container?.appendChild(iframe);
    iframeLoaded = true;
  };

  // Load after page loads
  setTimeout(loadV8Engine, 200);

  // Smooth fade out on scroll
  const v8Container = document.getElementById("v8-container");

  const handleScroll = () => {
    if (!v8Container) return;

    const scrollY = window.scrollY;
    const fadeStart = 0;
    const fadeEnd = window.innerHeight * 0.6; // Fade out over 60% of viewport

    if (scrollY <= fadeStart) {
      v8Container.style.opacity = "1";
    } else if (scrollY >= fadeEnd) {
      v8Container.style.opacity = "0";
      v8Container.style.visibility = "hidden";
    } else {
      const opacity = 1 - (scrollY - fadeStart) / (fadeEnd - fadeStart);
      v8Container.style.opacity = String(Math.max(0, opacity));
      v8Container.style.visibility = "visible";
    }
  };

  window.addEventListener("scroll", handleScroll, { passive: true });
  handleScroll();
</script>

<style>
  .v8-engine-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    z-index: 0;
    pointer-events: none;
    transition: opacity 0.5s ease-out;
    overflow: hidden;
    background: #000000;
  }

  .v8-engine-wrapper {
    position: absolute;
    top: 60%;
    left: 50%;
    transform: translate(-50%, -50%);
    /* Large size to fill background and crop UI */
    /* width: 250vw;
    height: 250vh; */
    width: 100vw;
    height: 120vh;
    overflow: hidden;
  }

  :global(.v8-iframe) {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100%;
    height: 100%;
    border: none;
    pointer-events: none;
    /* Grayscale, subtle visibility */
    opacity: 0.4;
    filter: grayscale(100%) brightness(0.9) contrast(1.2);
  }

  /* Loader */
  .v8-loader {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    transition: opacity 0.5s ease;
    z-index: 10;
  }

  .v8-loader.hidden {
    opacity: 0;
    pointer-events: none;
  }

  .loader-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid rgba(255, 255, 255, 0.1);
    border-top-color: var(--accent-primary, #ff4b4b);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  /* Large desktop */
  @media (min-width: 1400px) {
    .v8-engine-wrapper {
      width: 100vw;
      height: 120vh;
    }

    :global(.v8-iframe) {
      opacity: 0.3;
    }
  }

  /* Tablet */
  @media (max-width: 1024px) {
    .v8-engine-wrapper {
      width: 100vw;
      height: 120vh;
    }

    :global(.v8-iframe) {
      opacity: 0.35;
    }
  }

  /* Mobile: hide for performance */
  @media (max-width: 768px) {
    .v8-engine-container {
      /* display: none; */
      width: 100vw;
      height: 100vh;
    }
  }
</style>
